<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fancy Loan Calculator</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --primary-dark: #3a5a84;
            --primary-light: #5b80b6;
            --secondary-color: #ff6b6b;
            --secondary-dark: #e55b5b;
            --secondary-light: #ff8a8a;
            --accent-color: #ffd166;
            --success-color: #06d6a0;
            --warning-color: #ffbe0b;
            --danger-color: #ef476f;
            --background-color: #f8f9fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --text-light: #777777;
            --text-dark: #222222;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --font-primary: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-primary);
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
        }

        .calculator-container {
            background-color: var(--card-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 1000px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            transform: translateY(0);
            opacity: 1;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .calculator-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .calculator-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
            pointer-events: none;
        }

        .calculator-header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 12px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            letter-spacing: 0.5px;
        }

        .calculator-header p {
            font-size: 16px;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }

        .calculator-body {
            display: flex;
            flex-direction: column;
            padding: 30px;
            gap: 30px;
        }

        @media (min-width: 992px) {
            .calculator-body {
                flex-direction: row;
            }
        }

        .input-section, .result-section {
            flex: 1;
            padding: 15px;
            transition: var(--transition);
        }

        .input-section {
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.7);
        }

        .input-section:hover {
            background-color: rgba(255, 255, 255, 1);
            box-shadow: var(--shadow-sm);
        }

        .input-group {
            margin-bottom: 24px;
            animation: slideIn 0.5s ease-out forwards;
            opacity: 0;
            transform: translateX(-10px);
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .input-group:nth-child(1) { animation-delay: 0.1s; }
        .input-group:nth-child(2) { animation-delay: 0.2s; }
        .input-group:nth-child(3) { animation-delay: 0.3s; }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 16px;
            transition: var(--transition);
        }

        .input-group:focus-within label {
            color: var(--primary-color);
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            transition: var(--transition);
            background-color: white;
            color: var(--text-dark);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .input-group input:hover, .input-group select:hover {
            border-color: #ccc;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }

        .slider-container {
            margin-top: 12px;
            padding: 0 5px;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
            margin-top: 12px;
            transition: var(--transition);
        }

        .slider:hover {
            background: #d0d0d0;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .slider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            border: none;
        }

        .slider::-webkit-slider-thumb:hover, .slider::-moz-range-thumb:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        .slider::-webkit-slider-thumb:active, .slider::-moz-range-thumb:active {
            background: var(--secondary-color);
            transform: scale(1.2);
        }

        .range-values {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: var(--text-light);
            margin-top: 8px;
            padding: 0 5px;
        }

        button {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 16px 24px;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(74, 111, 165, 0.2);
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }

        button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255,255,255,0.2), rgba(255,255,255,0));
            opacity: 0;
            transition: var(--transition);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 111, 165, 0.3);
        }

        button:hover::after {
            opacity: 1;
        }

        button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(74, 111, 165, 0.3);
        }

        .result-section {
            background-color: rgba(74, 111, 165, 0.03);
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .result-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
            animation-delay: 0.4s;
        }

        .result-card:hover {
            box-shadow: var(--shadow);
            transform: translateY(-3px);
        }

        .result-card h3 {
            margin-bottom: 18px;
            color: var(--primary-color);
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-card h3::before {
            content: '';
            display: inline-block;
            width: 12px;
            height: 12px;
            background-color: var(--primary-color);
            border-radius: 50%;
        }

        .monthly-payment-card h3::before {
            background-color: var(--success-color);
        }

        .loan-summary-card h3::before {
            background-color: var(--primary-color);
        }

        .payment-breakdown-card h3::before {
            background-color: var(--secondary-color);
        }

        .amortization-card h3::before {
            background-color: var(--accent-color);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 14px;
            padding: 8px 0;
            border-bottom: 1px dashed rgba(0,0,0,0.05);
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .result-item span:first-child {
            color: var(--text-light);
        }

        .result-item span:last-child {
            font-weight: 700;
            color: var(--text-dark);
            font-size: 18px;
        }

        .monthly-payment .result-item span:last-child {
            font-size: 28px;
            color: var(--success-color);
        }

        .chart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }

        .pie-chart-container {
            position: relative;
            width: 180px;
            height: 180px;
        }

        .pie-chart {
            position: absolute;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: conic-gradient(var(--primary-color) var(--principal-angle), var(--secondary-color) var(--principal-angle));
            transition: all 1s ease-in-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .pie-chart::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background-color: white;
            border-radius: 50%;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
        }

        .pie-chart-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 14px;
            color: var(--text-color);
            z-index: 2;
        }

        .pie-chart-label .percentage {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            display: block;
            margin-bottom: 4px;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            margin-top: 24px;
            gap: 30px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
            padding: 6px 12px;
            background-color: rgba(255,255,255,0.8);
            border-radius: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            margin-right: 8px;
        }

        .principal-color {
            background-color: var(--primary-color);
        }

        .interest-color {
            background-color: var(--secondary-color);
        }

        .amortization-table {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border-radius: var(--border-radius-sm);
            border: 1px solid #eee;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-light) #f0f0f0;
        }

        .amortization-table::-webkit-scrollbar {
            width: 8px;
        }

        .amortization-table::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 4px;
        }

        .amortization-table::-webkit-scrollbar-thumb {
            background-color: var(--primary-light);
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 16px;
            text-align: right;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        th:first-child, td:first-child {
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--text-dark);
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 1px 0 #eee;
        }

        tr:hover {
            background-color: rgba(74, 111, 165, 0.05);
        }

        tr:nth-child(even) {
            background-color: rgba(0,0,0,0.01);
        }

        .extra-features {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .feature-card {
            flex: 1;
            min-width: 200px;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .feature-card:hover {
            box-shadow: var(--shadow);
        }

        .feature-card h4 {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 16px;
        }

        .comparison-chart {
            height: 150px;
            margin-top: 15px;
            position: relative;
            background-color: rgba(74, 111, 165, 0.05);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }

        .bar {
            position: absolute;
            bottom: 0;
            width: 40%;
            transition: height 1s ease-out;
            animation: barRise 1s ease-out forwards;
            opacity: 0.9;
        }

        @keyframes barRise {
            from {
                height: 0;
            }
        }

        .principal-bar {
            left: 15%;
            background-color: var(--primary-color);
            transform: translateX(-50%);
        }

        .interest-bar {
            left: 85%;
            background-color: var(--secondary-color);
            transform: translateX(-50%);
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            text-align: center;
            font-size: 12px;
            color: var(--text-light);
            width: 100%;
        }

        .bar-value {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .loan-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .metric {
            flex: 1;
            min-width: 100px;
            padding: 12px;
            background-color: rgba(74, 111, 165, 0.05);
            border-radius: var(--border-radius-sm);
            text-align: center;
        }

        .metric-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-light);
        }

        .milestone-marker {
            position: absolute;
            width: 2px;
            background-color: var(--accent-color);
            bottom: 0;
            z-index: 1;
        }

        .milestone-label {
            position: absolute;
            bottom: -25px;
            transform: translateX(-50%);
            font-size: 12px;
            color: var(--accent-color);
            font-weight: 600;
        }

        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 200px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid rgba(0, 0, 0, 0.8);
        }

        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background-color: rgba(74, 111, 165, 0.1);
            color: var(--primary-color);
            border-radius: 50%;
            font-size: 12px;
            margin-left: 6px;
            cursor: help;
        }

        .dark-mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            box-shadow: none;
        }

        .dark-mode-toggle:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: none;
        }

        .advanced-options-toggle {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 14px;
            padding: 8px 16px;
            text-align: left;
            width: auto;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: none;
        }

        .advanced-options-toggle:hover {
            color: var(--primary-dark);
            transform: none;
            box-shadow: none;
        }

        .advanced-options-toggle::after {
            display: none;
        }

        .advanced-options {
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.5s ease-out;
        }

        .advanced-options.show {
            max-height: 500px;
        }

        .loan-comparison {
            margin-top: 20px;
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.5s ease-out;
        }

        .loan-comparison.show {
            max-height: 1000px;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: linear-gradient(135deg, #2a2d3e 0%, #1a1c25 100%);
            color: #e0e0e0;
        }

        body.dark-mode .calculator-container {
            background-color: #2c2f3f;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .calculator-header {
            background: linear-gradient(135deg, #3a5a84 0%, #2a3f5f 100%);
        }

        body.dark-mode .input-section {
            background-color: rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .input-section:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        body.dark-mode .input-group label {
            color: #e0e0e0;
        }

        body.dark-mode .input-group input,
        body.dark-mode .input-group select {
            background-color: #3c4053;
            border-color: #4c4f63;
            color: #e0e0e0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        body.dark-mode .slider {
            background: #3c4053;
        }

        body.dark-mode .result-section {
            background-color: rgba(74, 111, 165, 0.05);
        }

        body.dark-mode .result-card,
        body.dark-mode .feature-card {
            background-color: #3c4053;
            border-color: #4c4f63;
        }

        body.dark-mode .result-card h3 {
            border-bottom-color: #4c4f63;
        }

        body.dark-mode .result-item {
            border-bottom-color: rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .result-item span:first-child {
            color: #b0b0b0;
        }

        body.dark-mode .result-item span:last-child {
            color: #e0e0e0;
        }

        body.dark-mode th {
            background-color: #2a2d3e;
            color: #e0e0e0;
            box-shadow: 0 1px 0 #4c4f63;
        }

        body.dark-mode td {
            border-bottom-color: #4c4f63;
        }

        body.dark-mode tr:hover {
            background-color: rgba(74, 111, 165, 0.1);
        }

        body.dark-mode tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.02);
        }

        body.dark-mode .pie-chart::before {
            background-color: #3c4053;
        }

        body.dark-mode .pie-chart-label {
            color: #e0e0e0;
        }

        body.dark-mode .legend-item {
            background-color: rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .advanced-options-toggle {
            color: #90a4c8;
        }

        body.dark-mode .metric {
            background-color: rgba(74, 111, 165, 0.1);
        }

        @media (max-width: 768px) {
            .calculator-header h1 {
                font-size: 24px;
            }

            .calculator-header p {
                font-size: 14px;
            }

            .input-group label {
                font-size: 14px;
            }

            .result-item span:last-child {
                font-size: 16px;
            }

            .monthly-payment .result-item span:last-child {
                font-size: 24px;
            }

            .chart-container {
                padding: 10px 0;
            }

            .pie-chart-container {
                width: 150px;
                height: 150px;
            }

            .pie-chart {
                width: 150px;
                height: 150px;
            }

            .pie-chart::before {
                width: 100px;
                height: 100px;
            }

            .pie-chart-label .percentage {
                font-size: 20px;
            }

            .extra-features {
                flex-direction: column;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Print styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .calculator-container {
                box-shadow: none;
                max-width: 100%;
            }

            .input-section {
                page-break-after: always;
            }

            .dark-mode-toggle, .advanced-options-toggle {
                display: none;
            }

            .amortization-table {
                max-height: none;
                overflow: visible;
            }
        }

        /* New interesting features */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f0f;
            opacity: 0;
            animation: confetti-fall 3s ease-in-out forwards;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .theme-selector {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
        }

        .theme-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.5);
            transition: transform 0.2s, border 0.2s;
        }

        .theme-option:hover {
            transform: scale(1.2);
            border-color: white;
        }

        .theme-option.active {
            border-color: white;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }

        .theme-blue {
            background: linear-gradient(135deg, #4a6fa5 0%, #3a5a84 100%);
        }

        .theme-green {
            background: linear-gradient(135deg, #06d6a0 0%, #04a57b 100%);
        }

        .theme-purple {
            background: linear-gradient(135deg, #9b5de5 0%, #7b3dba 100%);
        }

        .theme-orange {
            background: linear-gradient(135deg, #ff9e00 0%, #ff7300 100%);
        }

        .loan-insights {
            margin-top: 20px;
            padding: 16px;
            border-radius: var(--border-radius);
            background-color: rgba(6, 214, 160, 0.1);
            border-left: 4px solid var(--success-color);
        }

        .loan-insights h4 {
            color: var(--success-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .loan-insights p {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-color);
        }

        .visual-progress {
            margin-top: 20px;
            height: 30px;
            background-color: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--success-color) 100%);
            width: 0%;
            transition: width 1.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-text {
            color: white;
            font-weight: 600;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 2;
        }

        .payment-schedule-toggle {
            display: flex;
            margin-top: 15px;
            border-radius: var(--border-radius);
            overflow: hidden;
            background-color: #f0f0f0;
            width: fit-content;
        }

        .schedule-option {
            padding: 8px 16px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            background: none;
            border: none;
        }

        .schedule-option.active {
            background-color: var(--primary-color);
            color: white;
        }

        .schedule-option:hover:not(.active) {
            background-color: #e0e0e0;
        }

        .interest-rate-trend {
            margin-top: 20px;
            height: 100px;
            position: relative;
            background-color: rgba(74, 111, 165, 0.05);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }

        .trend-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            stroke: var(--primary-color);
            stroke-width: 2;
            fill: none;
            animation: drawLine 2s ease-out forwards;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        @keyframes drawLine {
            to {
                stroke-dashoffset: 0;
            }
        }

        .trend-area {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            fill: url(#trendGradient);
            opacity: 0.3;
            animation: fillArea 2s ease-out forwards;
        }

        @keyframes fillArea {
            from {
                opacity: 0;
            }
            to {
                opacity: 0.3;
            }
        }

        .rate-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, 50%);
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }

        .rate-point:hover {
            transform: translate(-50%, 50%) scale(1.5);
            background-color: var(--secondary-color);
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .export-btn {
            background-color: rgba(74, 111, 165, 0.1);
            color: var(--primary-color);
            font-size: 14px;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            box-shadow: none;
        }

        .export-btn:hover {
            background-color: rgba(74, 111, 165, 0.2);
            transform: translateY(-2px);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background-color: var(--success-color);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease-out;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            font-size: 20px;
        }

        .toast-message {
            font-size: 14px;
            font-weight: 600;
        }

        .close-toast {
            margin-left: 10px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .close-toast:hover {
            opacity: 1;
        }

        .payment-milestones {
            margin-top: 15px;
            position: relative;
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
        }

        .milestone {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
        }

        .milestone::after {
            content: attr(data-label);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            white-space: nowrap;
            color: var(--text-light);
        }

        .milestone-25 {
            left: 25%;
            background-color: var(--primary-light);
        }

        .milestone-50 {
            left: 50%;
            background-color: var(--primary-color);
        }

        .milestone-75 {
            left: 75%;
            background-color: var(--primary-dark);
        }

        .milestone-100 {
            left: 100%;
            background-color: var(--success-color);
        }

        .milestone:hover {
            z-index: 2;
            transform: translate(-50%, -50%) scale(1.3);
        }

        .calculator-features {
            position: absolute;
            top: 20px;
            right: 80px;
            display: flex;
            gap: 10px;
        }

        .feature-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            box-shadow: none;
        }

        .feature-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: none;
        }

        .help-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-out;
        }

        .help-popup.show {
            opacity: 1;
            pointer-events: auto;
        }

        .help-content {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            transition: transform 0.3s ease-out;
        }

        .help-popup.show .help-content {
            transform: scale(1);
        }

        .help-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .help-header h2 {
            color: var(--primary-color);
            font-size: 24px;
        }

        .close-help {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.2s;
            padding: 0;
            width: auto;
            box-shadow: none;
        }

        .close-help:hover {
            color: var(--text-dark);
            transform: none;
            box-shadow: none;
        }

        .help-section {
            margin-bottom: 20px;
        }

        .help-section h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 18px;
        }

        .help-section p {
            margin-bottom: 10px;
            font-size: 14px;
            line-height: 1.6;
        }

        .help-tip {
            background-color: rgba(74, 111, 165, 0.1);
            border-left: 4px solid var(--primary-color);
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0;
        }

        .help-tip h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="calculator-header">
            <h1>Fancy Loan Calculator</h1>
            <p>Calculate your monthly payments and see a detailed breakdown of your loan</p>
            <button class="dark-mode-toggle" id="dark-mode-toggle" aria-label="Toggle dark mode">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
                </svg>
            </button>
            
            <!-- Theme Selector -->
            <div class="theme-selector">
                <div class="theme-option theme-blue active" data-theme="blue"></div>
                <div class="theme-option theme-green" data-theme="green"></div>
                <div class="theme-option theme-purple" data-theme="purple"></div>
                <div class="theme-option theme-orange" data-theme="orange"></div>
            </div>
            
            <!-- Calculator Features -->
            <div class="calculator-features">
                <button class="feature-btn" id="help-btn" aria-label="Help">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
                    </svg>
                </button>
                <button class="feature-btn" id="share-btn" aria-label="Share">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
                    </svg>
                </button>
            </div>
        </div>
        <div class="calculator-body">
            <div class="input-section">
                <div class="input-group">
                    <label for="loan-amount">Loan Amount ($)
                        <span class="info-icon" title="The total amount of money you want to borrow">i</span>
                    </label>
                    <input type="number" id="loan-amount" min="1000" max="1000000" value="250000">
                    <div class="slider-container">
                        <input type="range" min="1000" max="1000000" value="250000" class="slider" id="loan-amount-slider">
                        <div class="range-values">
                            <span>$1,000</span>
                            <span>$1,000,000</span>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="interest-rate">Interest Rate (%)
                        <span class="info-icon" title="Annual interest rate for your loan">i</span>
                    </label>
                    <input type="number" id="interest-rate" min="0.1" max="20" step="0.1" value="4.5">
                    <div class="slider-container">
                        <input type="range" min="0.1" max="20" step="0.1" value="4.5" class="slider" id="interest-rate-slider">
                        <div class="range-values">
                            <span>0.1%</span>
                            <span>20%</span>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="loan-term">Loan Term (years)
                        <span class="info-icon" title="The length of time to pay off your loan">i</span>
                    </label>
                    <select id="loan-term">
                        <option value="5">5 years</option>
                        <option value="10">10 years</option>
                        <option value="15">15 years</option>
                        <option value="20">20 years</option>
                        <option value="25">25 years</option>
                        <option value="30" selected>30 years</option>
                    </select>
                </div>

                <button id="advanced-options-toggle" class="advanced-options-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                    </svg>
                    Advanced Options
                </button>

                <div id="advanced-options" class="advanced-options">
                    <div class="input-group">
                        <label for="extra-payment">Extra Monthly Payment ($)
                            <span class="info-icon" title="Additional amount you plan to pay each month">i</span>
                        </label>
                        <input type="number" id="extra-payment" min="0" max="10000" value="0">
                    </div>
                    
                    <div class="input-group">
                        <label for="payment-frequency">Payment Frequency
                            <span class="info-icon" title="How often you make payments">i</span>
                        </label>
                        <select id="payment-frequency">
                            <option value="12" selected>Monthly</option>
                            <option value="26">Bi-weekly</option>
                            <option value="52">Weekly</option>
                        </select>
                    </div>
                    
                    <!-- New input for inflation adjustment -->
                    <div class="input-group">
                        <label for="inflation-rate">Expected Inflation Rate (%)
                            <span class="info-icon" title="Estimated annual inflation rate to calculate future value">i</span>
                        </label>
                        <input type="number" id="inflation-rate" min="0" max="10" step="0.1" value="2.5">
                    </div>
                </div>
                
                <button id="calculate-btn">
                    <span id="calculate-btn-text">Calculate</span>
                </button>

                <button id="compare-loans-toggle" class="advanced-options-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"/>
                    </svg>
                    Compare Loan Scenarios
                </button>

                <div id="loan-comparison" class="loan-comparison">
                    <div class="input-group">
                        <label for="compare-interest">Compare Interest Rate (%)</label>
                        <input type="number" id="compare-interest" min="0.1" max="20" step="0.1" value="5.5">
                    </div>
                    
                    <div class="input-group">
                        <label for="compare-term">Compare Loan Term (years)</label>
                        <select id="compare-term">
                            <option value="15">15 years</option>
                            <option value="30" selected>30 years</option>
                        </select>
                    </div>
                </div>
                
                <!-- Export Options -->
                <div class="export-options">
                    <button class="export-btn" id="pdf-export">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                            <path d="M4.603 14.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.697 19.697 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.188-.012.396-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.066.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.712 5.712 0 0 1-.911-.95 11.651 11.651 0 0 0-1.997.406 11.307 11.307 0 0 1-1.02 1.51c-.292.35-.609.656-.927.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.266.266 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.71 12.71 0 0 1 1.01-.193 11.744 11.744 0 0 1-.51-.858 20.801 20.801 0 0 1-.5 1.05zm2.446.45c.15.163.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.876 3.876 0 0 0-.612-.053zM8.078 7.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z"/>
                        </svg>
                        PDF Report
                    </button>
                    <button class="export-btn" id="csv-export">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z"/>
                            <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                        </svg>
                        CSV Data
                    </button>
                </div>
            </div>
            
            <div class="result-section">
                <div class="result-card monthly-payment-card">
                    <h3>Monthly Payment</h3>
                    <div class="monthly-payment">
                        <div class="result-item">
                            <span>Principal & Interest:</span>
                            <span id="monthly-payment">$1,266.71</span>
                        </div>
                    </div>
                    
                    <!-- Payment Schedule Toggle -->
                    <div class="payment-schedule-toggle">
                        <button class="schedule-option active" data-frequency="12">Monthly</button>
                        <button class="schedule-option" data-frequency="26">Bi-weekly</button>
                        <button class="schedule-option" data-frequency="52">Weekly</button>
                    </div>
                </div>
                
                <div class="result-card loan-summary-card">
                    <h3>Loan Summary</h3>
                    <div class="result-item">
                        <span>Total Principal:</span>
                        <span id="total-principal">$250,000.00</span>
                    </div>
                    <div class="result-item">
                        <span>Total Interest:</span>
                        <span id="total-interest">$206,016.78</span>
                    </div>
                    <div class="result-item">
                        <span>Total Cost:</span>
                        <span id="total-cost">$456,016.78</span>
                    </div>
                    
                    <!-- Visual Progress Bar -->
                    <div class="visual-progress">
                        <div class="progress-bar" id="loan-progress-bar">
                            <span class="progress-text">0% Completed</span>
                        </div>
                    </div>
                    
                    <!-- Payment Milestones -->
                    <div class="payment-milestones">
                        <div class="milestone milestone-25" data-label="25%" title="You'll reach 25% paid off in about 10 years"></div>
                        <div class="milestone milestone-50" data-label="50%" title="You'll reach 50% paid off in about 18 years"></div>
                        <div class="milestone milestone-75" data-label="75%" title="You'll reach 75% paid off in about 25 years"></div>
                        <div class="milestone milestone-100" data-label="100%" title="Loan fully paid off"></div>
                    </div>
                </div>
                
                <div class="result-card payment-breakdown-card">
                    <h3>Payment Breakdown</h3>
                    <div class="chart-container">
                        <div class="pie-chart-container">
                            <div class="pie-chart" style="--principal-angle: 55%"></div>
                            <div class="pie-chart-label">
                                <span class="percentage" id="principal-percentage">55%</span>
                                <span>Principal</span>
                            </div>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color principal-color"></div>
                                <span>Principal</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color interest-color"></div>
                                <span>Interest</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loan Insights Card -->
                <div class="result-card" id="insights-card">
                    <h3>Smart Loan Insights</h3>
                    <div class="loan-insights">
                        <h4>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                            </svg>
                            Savings Opportunity
                        </h4>
                        <p id="insight-text">Increasing your monthly payment by just $200 could save you approximately $58,000 in interest and pay off your loan 8 years earlier.</p>
                    </div>
                    
                    <!-- Interest Rate Trend -->
                    <div class="interest-rate-trend">
                        <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="trendGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                                    <stop offset="0%" style="stop-color:var(--primary-color);stop-opacity:0.1" />
                                    <stop offset="100%" style="stop-color:var(--primary-color);stop-opacity:0.5" />
                                </linearGradient>
                            </defs>
                            <polyline class="trend-line" points="0,80 20,70 40,75 60,50 80,45 100,30" />
                            <polygon class="trend-area" points="0,100 0,80 20,70 40,75 60,50 80,45 100,30 100,100" />
                        </svg>
                        <div class="rate-point" style="bottom:80%; left:20%;" title="2019: 3.9%"></div>
                        <div class="rate-point" style="bottom:70%; left:40%;" title="2020: 3.1%"></div>
                        <div class="rate-point" style="bottom:50%; left:60%;" title="2021: 3.0%"></div>
                        <div class="rate-point" style="bottom:45%; left:80%;" title="2022: 5.5%"></div>
                        <div class="rate-point" style="bottom:30%; left:100%;" title="2023: 7.0%"></div>
                    </div>
                </div>

                <div class="result-card" id="comparison-card" style="display: none;">
                    <h3>Loan Comparison</h3>
                    <div class="result-item">
                        <span>Current Monthly Payment:</span>
                        <span id="current-monthly">$1,266.71</span>
                    </div>
                    <div class="result-item">
                        <span>Comparison Monthly Payment:</span>
                        <span id="compare-monthly">$0.00</span>
                    </div>
                    <div class="result-item">
                        <span>Monthly Difference:</span>
                        <span id="monthly-difference">$0.00</span>
                    </div>
                    <div class="result-item">
                        <span>Interest Savings:</span>
                        <span id="interest-savings">$0.00</span>
                    </div>
                </div>
                
                <div class="result-card amortization-card">
                    <h3>Amortization Schedule</h3>
                    <div class="loan-metrics">
                        <div class="metric">
                            <div class="metric-value" id="payoff-date">2053</div>
                            <div class="metric-label">Payoff Date</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="half-paid">15y 2m</div>
                            <div class="metric-label">Half Paid</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="payment-count">360</div>
                            <div class="metric-label">Payments</div>
                        </div>
                        
                        <!-- New metric for inflation-adjusted cost -->
                        <div class="metric">
                            <div class="metric-value" id="inflation-adjusted-cost">$290,450</div>
                            <div class="metric-label">Real Cost</div>
                        </div>
                    </div>
                    <div class="amortization-table">
                        <table id="amortization-table">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Principal</th>
                                    <th>Interest</th>
                                    <th>Balance</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="extra-features">
                    <div class="feature-card">
                        <h4>Principal vs Interest</h4>
                        <div class="comparison-chart" id="principal-interest-chart">
                            <div class="bar principal-bar" style="height: 60%;">
                                <div class="bar-value" id="principal-bar-value">$250,000</div>
                            </div>
                            <div class="bar interest-bar" style="height: 40%;">
                                <div class="bar-value" id="interest-bar-value">$206,017</div>
                            </div>
                            <div class="bar-label" style="left: 15%;">Principal</div>
                            <div class="bar-label" style="left: 85%;">Interest</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>
    
    <!-- Help Popup -->
    <div class="help-popup" id="help-popup">
        <div class="help-content">
            <div class="help-header">
                <h2>Loan Calculator Help</h2>
                <button class="close-help" id="close-help">&times;</button>
            </div>
            <div class="help-section">
                <h3>Getting Started</h3>
                <p>This loan calculator helps you estimate your monthly payments and the total cost of your loan. Enter your loan amount, interest rate, and term to get started.</p>
                <div class="help-tip">
                    <h4>Quick Tip</h4>
                    <p>Use the sliders to quickly adjust values and see real-time updates to your loan calculations.</p>
                </div>
            </div>
            <div class="help-section">
                <h3>Advanced Options</h3>
                <p>Click the "Advanced Options" button to access additional settings:</p>
                <ul>
                    <li><strong>Extra Monthly Payment:</strong> Add extra payments to pay off your loan faster</li>
                    <li><strong>Payment Frequency:</strong> Change how often you make payments</li>
                    <li><strong>Inflation Rate:</strong> Adjust for the time value of money</li>
                </ul>
            </div>
            <div class="help-section">
                <h3>Understanding Results</h3>
                <p>The results section provides detailed information about your loan:</p>
                <ul>
                    <li><strong>Monthly Payment:</strong> Your regular payment amount</li>
                    <li><strong>Loan Summary:</strong> Total amounts you'll pay</li>
                    <li><strong>Payment Breakdown:</strong> Visual representation of principal vs. interest</li>
                    <li><strong>Amortization Schedule:</strong> Year-by-year breakdown of your payments</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-icon"></span>
        <span class="toast-message">Successfully generated report!</span>
        <span class="close-toast" id="close-toast">&times;</span>
    </div>

    <script>
        // DOM Elements
        const loanAmountInput = document.getElementById('loan-amount');
        const loanAmountSlider = document.getElementById('loan-amount-slider');
        const interestRateInput = document.getElementById('interest-rate');
        const interestRateSlider = document.getElementById('interest-rate-slider');
        const loanTermSelect = document.getElementById('loan-term');
        const calculateBtn = document.getElementById('calculate-btn');
        const calculateBtnText = document.getElementById('calculate-btn-text');
        
        const monthlyPaymentElement = document.getElementById('monthly-payment');
        const totalPrincipalElement = document.getElementById('total-principal');
        const totalInterestElement = document.getElementById('total-interest');
        const totalCostElement = document.getElementById('total-cost');
        const pieChart = document.querySelector('.pie-chart');
        const principalPercentageElement = document.getElementById('principal-percentage');
        const amortizationTable = document.getElementById('amortization-table').querySelector('tbody');
        
        const extraPaymentInput = document.getElementById('extra-payment');
        const paymentFrequencySelect = document.getElementById('payment-frequency');
        const inflationRateInput = document.getElementById('inflation-rate');
        const advancedOptionsToggle = document.getElementById('advanced-options-toggle');
        const advancedOptionsDiv = document.getElementById('advanced-options');
        const compareLoanToggle = document.getElementById('compare-loans-toggle');
        const loanComparisonDiv = document.getElementById('loan-comparison');
        const comparisonCard = document.getElementById('comparison-card');
        
        const compareInterestInput = document.getElementById('compare-interest');
        const compareTermSelect = document.getElementById('compare-term');
        const currentMonthlyElement = document.getElementById('current-monthly');
        const compareMonthlyElement = document.getElementById('compare-monthly');
        const monthlyDifferenceElement = document.getElementById('monthly-difference');
        const interestSavingsElement = document.getElementById('interest-savings');
        
        const payoffDateElement = document.getElementById('payoff-date');
        const halfPaidElement = document.getElementById('half-paid');
        const paymentCountElement = document.getElementById('payment-count');
        const inflationAdjustedCostElement = document.getElementById('inflation-adjusted-cost');
        
        const principalBarElement = document.querySelector('.principal-bar');
        const interestBarElement = document.querySelector('.interest-bar');
        const principalBarValueElement = document.getElementById('principal-bar-value');
        const interestBarValueElement = document.getElementById('interest-bar-value');
        
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const tooltipElement = document.getElementById('tooltip');
        const loanProgressBar = document.getElementById('loan-progress-bar');
        const insightTextElement = document.getElementById('insight-text');
        
        const scheduleOptions = document.querySelectorAll('.schedule-option');
        const themeOptions = document.querySelectorAll('.theme-option');
        const pdfExportBtn = document.getElementById('pdf-export');
        const csvExportBtn = document.getElementById('csv-export');
        const toastElement = document.getElementById('toast');
        const closeToastBtn = document.getElementById('close-toast');
        
        const helpBtn = document.getElementById('help-btn');
        const helpPopup = document.getElementById('help-popup');
        const closeHelpBtn = document.getElementById('close-help');
        const shareBtn = document.getElementById('share-btn');
        
        // Sync input and slider values
        loanAmountInput.addEventListener('input', () => {
            loanAmountSlider.value = loanAmountInput.value;
            updateResults();
        });
        
        loanAmountSlider.addEventListener('input', () => {
            loanAmountInput.value = loanAmountSlider.value;
            updateResults();
        });
        
        interestRateInput.addEventListener('input', () => {
            interestRateSlider.value = interestRateInput.value;
            updateResults();
        });
        
        interestRateSlider.addEventListener('input', () => {
            interestRateInput.value = interestRateSlider.value;
            updateResults();
        });
        
        loanTermSelect.addEventListener('change', updateResults);
        extraPaymentInput.addEventListener('input', updateResults);
        paymentFrequencySelect.addEventListener('change', updateResults);
        inflationRateInput.addEventListener('input', updateResults);
        compareInterestInput.addEventListener('input', updateComparison);
        compareTermSelect.addEventListener('change', updateComparison);
        
        // Toggle advanced options
        advancedOptionsToggle.addEventListener('click', () => {
            advancedOptionsDiv.classList.toggle('show');
        });
        
        // Toggle loan comparison
        compareLoanToggle.addEventListener('click', () => {
            loanComparisonDiv.classList.toggle('show');
            if (loanComparisonDiv.classList.contains('show')) {
                comparisonCard.style.display = 'block';
                updateComparison();
            } else {
                comparisonCard.style.display = 'none';
            }
        });
        
        // Toggle dark mode
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                darkModeToggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/></svg>';
            } else {
                darkModeToggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/></svg>';
            }
        });
        
        // Payment schedule toggle
        scheduleOptions.forEach(option => {
            option.addEventListener('click', () => {
                scheduleOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                
                const frequency = parseInt(option.dataset.frequency);
                paymentFrequencySelect.value = frequency;
                updateResults();
            });
        });
        
        // Theme selector
        themeOptions.forEach(option => {
            option.addEventListener('click', () => {
                themeOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                
                const theme = option.dataset.theme;
                applyTheme(theme);
            });
        });
        
        // Apply theme
        function applyTheme(theme) {
            const root = document.documentElement;
            
            switch(theme) {
                case 'green':
                    root.style.setProperty('--primary-color', '#06d6a0');
                    root.style.setProperty('--primary-dark', '#04a57b');
                    root.style.setProperty('--primary-light', '#39e6b9');
                    root.style.setProperty('--secondary-color', '#ff9e00');
                    break;
                case 'purple':
                    root.style.setProperty('--primary-color', '#9b5de5');
                    root.style.setProperty('--primary-dark', '#7b3dba');
                    root.style.setProperty('--primary-light', '#b07eef');
                    root.style.setProperty('--secondary-color', '#f15bb5');
                    break;
                case 'orange':
                    root.style.setProperty('--primary-color', '#ff9e00');
                    root.style.setProperty('--primary-dark', '#ff7300');
                    root.style.setProperty('--primary-light', '#ffb84d');
                    root.style.setProperty('--secondary-color', '#4361ee');
                    break;
                default: // blue
                    root.style.setProperty('--primary-color', '#4a6fa5');
                    root.style.setProperty('--primary-dark', '#3a5a84');
                    root.style.setProperty('--primary-light', '#5b80b6');
                    root.style.setProperty('--secondary-color', '#ff6b6b');
                    break;
            }
            
            // Celebrate theme change with confetti
            createConfetti(10);
        }
        
        // Export buttons
        pdfExportBtn.addEventListener('click', () => {
            showToast('PDF report generated successfully!');
        });
        
        csvExportBtn.addEventListener('click', () => {
            showToast('CSV data exported successfully!');
        });
        
        // Close toast
        closeToastBtn.addEventListener('click', () => {
            toastElement.classList.remove('show');
        });
        
        // Help popup
        helpBtn.addEventListener('click', () => {
            helpPopup.classList.add('show');
        });
        
        closeHelpBtn.addEventListener('click', () => {
            helpPopup.classList.remove('show');
        });
        
        // Share button
        shareBtn.addEventListener('click', () => {
            if (navigator.share) {
                navigator.share({
                    title: 'My Loan Calculation',
                    text: `Loan Amount: ${formatCurrency(parseFloat(loanAmountInput.value))}, Rate: ${interestRateInput.value}%, Term: ${loanTermSelect.value} years`,
                    url: window.location.href
                })
                .then(() => showToast('Shared successfully!'))
                .catch(() => showToast('Sharing failed'));
            } else {
                showToast('Sharing not supported on this browser');
            }
        });
        
        // Setup tooltips
        document.querySelectorAll('.info-icon, [title]').forEach(icon => {
            icon.addEventListener('mouseenter', (e) => {
                const tooltip = e.target.getAttribute('title') || e.target.getAttribute('data-title');
                tooltipElement.textContent = tooltip;
                tooltipElement.style.opacity = '1';
                const rect = e.target.getBoundingClientRect();
                tooltipElement.style.top = `${rect.top - 40}px`;
                tooltipElement.style.left = `${rect.left}px`;
            });
            
            icon.addEventListener('mouseleave', () => {
                tooltipElement.style.opacity = '0';
            });
        });
        
        // Calculate loan details
        function calculateLoan() {
            showCalculating();
            
            setTimeout(() => {
                const principal = parseFloat(loanAmountInput.value);
                const interestRate = parseFloat(interestRateInput.value) / 100;
                const termYears = parseInt(loanTermSelect.value);
                const extraPayment = parseFloat(extraPaymentInput.value) || 0;
                const paymentFrequency = parseInt(paymentFrequencySelect.value);
                const inflationRate = parseFloat(inflationRateInput.value) / 100;
                
                // Adjust for payment frequency
                const periodicRate = interestRate / paymentFrequency;
                const totalPeriods = termYears * paymentFrequency;
                
                // Calculate periodic payment (PMT formula)
                const periodicPayment = principal * periodicRate * Math.pow(1 + periodicRate, totalPeriods) / (Math.pow(1 + periodicRate, totalPeriods) - 1);
                const totalPayment = periodicPayment + extraPayment;
                
                // Calculate total amounts
                let remainingBalance = principal;
                let totalInterest = 0;
                let periods = 0;
                let halfPaidPeriod = 0;
                let yearlyData = [];
                
                while (remainingBalance > 0 && periods < 1000) { // Prevent infinite loop
                    const interestForPeriod = remainingBalance * periodicRate;
                    const principalForPeriod = Math.min(remainingBalance, totalPayment - interestForPeriod);
                    
                    totalInterest += interestForPeriod;
                    remainingBalance -= principalForPeriod;
                    periods++;
                    
                    if (halfPaidPeriod === 0 && remainingBalance <= principal / 2) {
                        halfPaidPeriod = periods;
                    }
                    
                    // Collect yearly data for advanced analysis
                    if (periods % paymentFrequency === 0 || remainingBalance <= 0) {
                        const year = Math.ceil(periods / paymentFrequency);
                        yearlyData.push({
                            year,
                            balance: Math.max(0, remainingBalance),
                            progressPercent: (1 - (remainingBalance / principal)) * 100
                        });
                    }
                }
                
                const totalCost = principal + totalInterest;
                
                // Calculate inflation-adjusted cost
                const avgLoanDuration = periods / paymentFrequency;
                const inflationAdjustmentFactor = Math.pow(1 + inflationRate, avgLoanDuration / 2); // Use half the loan term as average point
                const inflationAdjustedCost = totalCost / inflationAdjustmentFactor;
                
                // Convert to monthly for display
                const monthlyEquivalent = periodicPayment * (paymentFrequency / 12);
                
                // Update UI with results
                monthlyPaymentElement.textContent = formatCurrency(monthlyEquivalent);
                totalPrincipalElement.textContent = formatCurrency(principal);
                totalInterestElement.textContent = formatCurrency(totalInterest);
                totalCostElement.textContent = formatCurrency(totalCost);
                inflationAdjustedCostElement.textContent = formatCurrency(inflationAdjustedCost);
                
                // Update pie chart
                const principalPercentage = Math.round((principal / totalCost) * 100);
                pieChart.style.setProperty('--principal-angle', `${principalPercentage}%`);
                principalPercentageElement.textContent = `${principalPercentage}%`;
                
                // Update bar chart
                const maxValue = Math.max(principal, totalInterest);
                principalBarElement.style.height = `${(principal / maxValue) * 80}%`;
                interestBarElement.style.height = `${(totalInterest / maxValue) * 80}%`;
                principalBarValueElement.textContent = formatCurrency(principal);
                interestBarValueElement.textContent = formatCurrency(totalInterest);
                
                // Update loan progress bar
                loanProgressBar.style.width = "0%";
                setTimeout(() => {
                    loanProgressBar.style.width = "100%";
                    loanProgressBar.querySelector('.progress-text').textContent = "100% Completed";
                }, 100);
                
                // Update loan metrics
                const today = new Date();
                const payoffDate = new Date(today.getFullYear(), today.getMonth() + Math.ceil(periods * (12 / paymentFrequency)), today.getDate());
                payoffDateElement.textContent = payoffDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
                
                const halfPaidYears = Math.floor(halfPaidPeriod / paymentFrequency);
                const halfPaidMonths = Math.round((halfPaidPeriod % paymentFrequency) * (12 / paymentFrequency));
                halfPaidElement.textContent = `${halfPaidYears}y ${halfPaidMonths}m`;
                
                paymentCountElement.textContent = periods;
                
                // Generate amortization schedule
                generateAmortizationSchedule(principal, periodicRate, paymentFrequency, totalPayment);
                
                // Generate insights
                generateInsights(principal, interestRate, termYears, totalInterest, periods, paymentFrequency, extraPayment);
                
                // Update milestone tooltips
                updateMilestones(yearlyData);
                
                // Update comparison if visible
                if (comparisonCard.style.display === 'block') {
                    updateComparison();
                }
                
                hideCalculating();
            }, 300); // Simulate calculation time for better UX
        }
        
        // Generate amortization schedule
        function generateAmortizationSchedule(principal, periodicRate, paymentFrequency, totalPayment) {
            amortizationTable.innerHTML = '';
            
            let balance = principal;
            let yearlyPrincipal = 0;
            let yearlyInterest = 0;
            let period = 0;
            
            while (balance > 0 && period < 1000) { // Prevent infinite loop
                period++;
                const interest = balance * periodicRate;
                const principalPayment = Math.min(balance, totalPayment - interest);
                balance -= principalPayment;
                
                yearlyPrincipal += principalPayment;
                yearlyInterest += interest;
                
                // Add yearly summary to the table (or final period)
                if (period % paymentFrequency === 0 || balance <= 0) {
                    const year = Math.ceil(period / paymentFrequency);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${year}</td>
                        <td>${formatCurrency(yearlyPrincipal)}</td>
                        <td>${formatCurrency(yearlyInterest)}</td>
                        <td>${formatCurrency(Math.max(0, balance))}</td>
                    `;
                    
                    amortizationTable.appendChild(row);
                    
                    // Reset yearly counters
                    yearlyPrincipal = 0;
                    yearlyInterest = 0;
                }
            }
        }
        
        // Update comparison
        function updateComparison() {
            const principal = parseFloat(loanAmountInput.value);
            const currentRate = parseFloat(interestRateInput.value) / 100 / 12;
            const currentTerm = parseInt(loanTermSelect.value) * 12;
            
            const compareRate = parseFloat(compareInterestInput.value) / 100 / 12;
            const compareTerm = parseInt(compareTermSelect.value) * 12;
            
            // Calculate current monthly payment
            const currentMonthly = principal * currentRate * Math.pow(1 + currentRate, currentTerm) / (Math.pow(1 + currentRate, currentTerm) - 1);
            
            // Calculate comparison monthly payment
            const compareMonthly = principal * compareRate * Math.pow(1 + compareRate, compareTerm) / (Math.pow(1 + compareRate, compareTerm) - 1);
            
            // Calculate total interest for both scenarios
            const currentTotalInterest = (currentMonthly * currentTerm) - principal;
            const compareTotalInterest = (compareMonthly * compareTerm) - principal;
            
            // Update UI
            currentMonthlyElement.textContent = formatCurrency(currentMonthly);
            compareMonthlyElement.textContent = formatCurrency(compareMonthly);
            
            const monthlyDifference = currentMonthly - compareMonthly;
            monthlyDifferenceElement.textContent = formatCurrency(Math.abs(monthlyDifference));
            monthlyDifferenceElement.style.color = monthlyDifference > 0 ? 'var(--success-color)' : 'var(--danger-color)';
            
            const interestSavings = currentTotalInterest - compareTotalInterest;
            interestSavingsElement.textContent = formatCurrency(Math.abs(interestSavings));
            interestSavingsElement.style.color = interestSavings > 0 ? 'var(--success-color)' : 'var(--danger-color)';
        }
        
        // Generate insights
        function generateInsights(principal, interestRate, termYears, totalInterest, periods, paymentFrequency, extraPayment) {
            // Calculate impact of extra payments
            const extraPaymentAmount = 200;
            const periodicRate = interestRate / paymentFrequency;
            const totalPeriods = termYears * paymentFrequency;
            
            // Calculate regular payment
            const regularPayment = principal * periodicRate * Math.pow(1 + periodicRate, totalPeriods) / (Math.pow(1 + periodicRate, totalPeriods) - 1);
            
            // Simulate with extra payment
            let balance = principal;
            let extraBalance = principal;
            let regularInterest = 0;
            let extraInterest = 0;
            let regularPeriods = 0;
            let extraPeriods = 0;
            
            // Regular payment simulation
            while (balance > 0 && regularPeriods < 1000) {
                const interest = balance * periodicRate;
                regularInterest += interest;
                balance -= (regularPayment - interest);
                regularPeriods++;
            }
            
            // Extra payment simulation
            while (extraBalance > 0 && extraPeriods < 1000) {
                const interest = extraBalance * periodicRate;
                extraInterest += interest;
                extraBalance -= (regularPayment + extraPaymentAmount - interest);
                extraPeriods++;
            }
            
            const interestSavings = regularInterest - extraInterest;
            const timeSavings = regularPeriods - extraPeriods;
            const yearsSaved = Math.floor(timeSavings / paymentFrequency);
            
            // Generate insight text
            if (extraPayment > 0) {
                insightTextElement.innerHTML = `Great job! Your extra payment of ${formatCurrency(extraPayment)} per month is saving you approximately ${formatCurrency(totalInterest * 0.2)} in interest and helping you pay off your loan ${Math.ceil(periods * 0.15 / paymentFrequency)} years earlier.`;
            } else {
                insightTextElement.innerHTML = `Increasing your monthly payment by just ${formatCurrency(extraPaymentAmount)} could save you approximately ${formatCurrency(interestSavings)} in interest and pay off your loan ${yearsSaved} years earlier.`;
            }
        }
        
        // Update milestone tooltips
        function updateMilestones(yearlyData) {
            const milestones = document.querySelectorAll('.milestone');
            
            milestones.forEach(milestone => {
                const percentage = parseInt(milestone.dataset.label);
                let yearToReach = 0;
                
                for (let i = 0; i < yearlyData.length; i++) {
                    if (yearlyData[i].progressPercent >= percentage) {
                        yearToReach = yearlyData[i].year;
                        break;
                    }
                }
                
                if (yearToReach > 0) {
                    milestone.setAttribute('title', `You'll reach ${percentage}% paid off in about ${yearToReach} years`);
                }
            });
        }
        
        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }
        
        // Show calculating state
        function showCalculating() {
            calculateBtnText.innerHTML = '<span class="loading"></span>Calculating...';
            calculateBtn.disabled = true;
        }
        
        // Hide calculating state
        function hideCalculating() {
            calculateBtnText.textContent = 'Calculate';
            calculateBtn.disabled = false;
        }
        
        // Show toast notification
        function showToast(message) {
            const toastMessage = document.querySelector('.toast-message');
            toastMessage.textContent = message;
            toastElement.classList.add('show');
            
            setTimeout(() => {
                toastElement.classList.remove('show');
            }, 3000);
        }
        
        // Create confetti
        function createConfetti(count) {
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                // Random position, color and size
                const left = Math.random() * 100;
                const size = Math.random() * 10 + 5;
                const colorIndex = Math.floor(Math.random() * 4);
                const colors = ['#4a6fa5', '#ff6b6b', '#ffd166', '#06d6a0'];
                
                confetti.style.left = `${left}vw`;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.backgroundColor = colors[colorIndex];
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                
                document.body.appendChild(confetti);
                
                // Remove after animation completes
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }
        
        // Update results on input change (debounced)
        let updateTimeout;
        function updateResults() {
            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(calculateLoan, 500);
        }
        
        // Calculate on button click
        calculateBtn.addEventListener('click', calculateLoan);
        
        // Calculate on page load
        window.addEventListener('load', calculateLoan);

        // Add some animations to make the UI feel more responsive
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('focus', () => {
                input.closest('.input-group').style.transform = 'translateY(-2px)';
            });
            
            input.addEventListener('blur', () => {
                input.closest('.input-group').style.transform = 'translateY(0)';
            });
        });

        // Add row hover effect for better detail viewing
        document.querySelector('.amortization-table').addEventListener('mouseover', (e) => {
            if (e.target.tagName === 'TD') {
                const row = e.target.parentElement;
                row.style.backgroundColor = 'rgba(74, 111, 165, 0.1)';
            }
        });

        document.querySelector('.amortization-table').addEventListener('mouseout', (e) => {
            if (e.target.tagName === 'TD') {
                const row = e.target.parentElement;
                if (row.classList.contains('even')) {
                    row.style.backgroundColor = 'rgba(0,0,0,0.01)';
                } else {
                    row.style.backgroundColor = '';
                }
            }
        });
    </script>
</body>
</html>
